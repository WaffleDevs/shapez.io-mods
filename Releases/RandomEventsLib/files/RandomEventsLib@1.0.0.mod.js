/**!
 * Name: RandomEventsLib
 * Description: A library allowing developers to add custom events to the game!
 * Version: 1.0.0
 * Author(s): WaffleDevs
 */
var m=function(e,t,n,s,i,a,o,d){"use strict";const r={name:"RandomEventsLib",description:"A library allowing developers to add custom events to the game!",version:"1.0.0",settings:{seed:0,randomEventInterval:3e4,stateEnterEventChance:10,closeGameChance:1,disabledEvents:[]},extra:{settingsState:"RELModExtrasSettingsState",authors:[{name:"WaffleDevs",email:"",website:"https://skimnerphi.net/waffledevs",icon:"https://avatars.githubusercontent.com/u/77215539?s=64"}],updateURL:"https://skimnerphi.net/api/v1/latest/RandomEventsLib"},id:"RandomEventsLib",author:"WaffleDevs",doesNotAffectSavegame:!0,website:"https://skimnerphi.net/mods/RandomEventsLib"};r.extra.readme='<h1>Random Events Lib</h1>\n<p>Author: WaffleDevs\nVersion: 0.0.0\nMod Id: wah</p>\n<h3>Description</h3>\n<p>Allows mods to add Random Events that can happen upon entering a state (Ex. Going to the main menu, Opening the settings.) or can happen randomly during gameplay.\n<strong>Note: This mod doesn&#39;t do anything on it&#39;s own. You will need to download a mod using this library for it to do anything.</strong></p>\n<h3>For Modders</h3>\n<p>There is an API that allows easily adding new State Enter Events (SEE) and Ingame Random Events (IRE).</p>\n<p>To access it, get <code>window.REL</code> during the Preloader state.</p>\n<blockquote>\n<p><code>window.REL.registerStateEnterEvent(eventName: string, state: string, func: Function)</code></p>\n<p>Registers an SEE with name <code>eventName</code> that has a <code>X</code> chance to run <code>func</code> when <code>signals.stateEntered</code> runs for state <code>state</code>.<code>X</code> is determined by the mod&#39;s config entry, <code>stateEnterEventChance</code>. </p>\n</blockquote>\n<blockquote>\n<p><code>window.REL.registerIngameRandomEvent(eventName: string, func: Function)</code></p>\n<p>Registers an IRE with name <code>eventName</code> that has a chance to run <code>func</code> every <code>X</code> seconds. <code>X</code> is determined by the mod&#39;s config entry, <code>randomEventInterval</code>.</p>\n</blockquote>\n<p>There is also a modified version <a href="https://github.com/tobspr-games/shapez.io/blob/master/src/js/core/rng.js"><code>src/js/core/rng.js</code></a> with the following methods:</p>\n<blockquote>\n<p><code>window.REL.RNG.chance(chance: number)</code></p>\n<p>Returns true every <code>chance</code>% of times.</p>\n</blockquote>\n<blockquote>\n<p><code>window.REL.RNG.choiceDict(obj: Object)</code></p>\n<p>The Object version of <code>RandomNumberGenerator.choice(array: Array)</code>. Returns a random key from the given Object.</p>\n</blockquote>\n<p>The lib also allows for editing the <code>stateEnterEventChance</code> and <code>randomEventInterval</code> in case you want to mello out the experience or turn it to full hell.</p>\n',r.extra.changelog={"1.0.0":["Release"]};const c="https://skimnerphi.net/mods/mod_extras/";function h(e,t=!1){const n="ModExtras"in window&&window.ModExtras.version||null,s=e.signals.stateEntered;function i(n){"MainMenuState"===n.key&&(!function(e,t=!1){const{getModExtras:n}=e.dialogs.showWarning("Mod Extras Missing",t?`Mod "${e.metadata.name}" recommends an up-to-date\n        version of Mod Extras to function properly.`:`Mod "${e.metadata.name}" requires an up-to-date\n        version of Mod Extras to function properly.`,["later:bad","getModExtras:good"]);n.add((()=>{e.app.platformWrapper.openExternalLink(c)}))}(e,t),s.remove(this))}return null===n&&(a.T.dialogs.buttons.getModExtras="Get Mod Extras",s.add(i,i)),null!==n}function l(e,t){const n=document.createElement("label");return n.innerText=e,n.appendChild(t),n}function m(e){const t=document.createElement("input");return t.type="checkbox",t.checked=e,t}function E(e,t){(e<1||e>6)&&(e=6);const n=document.createElement(`H${e}`);return n.textContent=t,n}class g extends o.TextualGameState{constructor(){super("RELModExtrasSettingsState"),this.mod=i.MODS.mods.find((e=>"RandomEventsLib"==e.metadata.id))}getStateHeaderTitle(){return a.T.about.title}onEnter(){const e=document.querySelector(".mainContent");if(d.makeDiv(e,void 0,[],"Settings"),0==Object.keys(this.mod.stateEnterEvents).length||0==Object.keys(this.mod.ingameRandomEvents).length)return;console.log(this.mod.stateEnterEvents),e.appendChild(E(2,"Events")),e.appendChild(E(3,"State Enter Events"));let t=[];for(const n in this.mod.stateEnterEvents)for(const s in this.mod.stateEnterEvents[n]){if(2==s.split(":").length){const n=s.split(":")[0];t.includes(n)||(t.push(n),e.appendChild(E(4,n)));let i=m(!0);this.mod.settings.disabledEvents.includes(s)&&(i=m(!1)),i.addEventListener("change",(()=>{if(!this.mod.settings.disabledEvents.includes(s)||i.checked){if(this.mod.settings.disabledEvents.includes(s)&&i.checked){const e=this.mod.settings.disabledEvents.indexOf(s);e>-1&&this.mod.settings.disabledEvents.splice(e,1)}this.mod.settings.disabledEvents.includes(s)||i.checked||this.mod.settings.disabledEvents.push(s)}})),e.appendChild(l(s.split(":")[1],i));continue}const n=m(!0);n.addEventListener("change",(()=>{if(!this.mod.settings.disabledEvents.includes(s)||n.checked){if(this.mod.settings.disabledEvents.includes(s)&&n.checked){const e=this.mod.settings.disabledEvents.indexOf(s);e>-1&&this.mod.settings.disabledEvents.splice(e,1)}this.mod.settings.disabledEvents.includes(s)||n.checked||this.mod.settings.disabledEvents.push(s)}})),e.appendChild(l(s,n))}e.appendChild(E(3,"Ingame Random Events"));let n=[];for(const t in this.mod.ingameRandomEvents){if(2==t.split(":").length){const s=t.split(":")[0];n.includes(s)||(n.push(s),e.appendChild(E(4,s)));let i=m(!0);this.mod.settings.disabledEvents.includes(t)&&(i=m(!1)),i.addEventListener("change",(()=>{if(!this.mod.settings.disabledEvents.includes(t)||i.checked){if(this.mod.settings.disabledEvents.includes(t)&&i.checked){const e=this.mod.settings.disabledEvents.indexOf(t);e>-1&&this.mod.settings.disabledEvents.splice(e,1)}this.mod.settings.disabledEvents.includes(t)||i.checked||this.mod.settings.disabledEvents.push(t)}})),e.appendChild(l(t.split(":")[1],i));continue}const s=m(!0);s.addEventListener("change",(()=>{if(!this.mod.settings.disabledEvents.includes(t)||s.checked){if(this.mod.settings.disabledEvents.includes(t)&&s.checked){const e=this.mod.settings.disabledEvents.indexOf(t);e>-1&&this.mod.settings.disabledEvents.splice(e,1)}this.mod.settings.disabledEvents.includes(t)||s.checked||this.mod.settings.disabledEvents.push(t)}})),e.appendChild(l(t,s))}}onLeave(){this.mod.saveSettings()}getDefaultPreviousState(){return"SettingsState"}}const u=t.createLogger("random_event_lib"),v=["ingame"];class p extends s.Mod{constructor(){super(...arguments),this.stateEnterEvents={},this.ingameRandomEvents={},this.seed=0,this.RNG=new n.RandomNumberGenerator,this.stateEnterEventChance=this.settings.stateEnterEventChance,this.randomEventInterval=this.settings.randomEventInterval}init(){if(this.metadata.extra.readme="<h1>RandomEventsLib</h1><h2>Latest: 1.0.0</h2><p>WaffleDevs</p><p>A library allowing developers to add custom events to the game!</p>",this.modInterface.registerCss(b),!h(this,!0))return;0==this.settings.seed&&(this.settings.seed=Date.now(),this.saveSettings()),this.seed=Math.floor(Date.now()*this.settings.seed/(10000100001e4*Math.random())),this.RNG.choiceDict=function(e){const t=Object.keys(e);return this.choice(t)},this.RNG.chance=e=>Number.isNaN(e-1)?new Error("Argument 0 is Not A Number."):this.RNG.nextIntRange(1,100)<=e,this.RNG.reseed(this.seed);let e=!1;this.signals.stateEntered.add((t=>{if("PreloadState"===t.key)window.REL=i.MODS.mods.find((e=>e.metadata.id===this.metadata.id)),this.modInterface.registerGameState(g);else if("MainMenuState"===t.key){if(e)return;this.initStateEnterEvents(),this.initIngameRandomEvents(),e=!0}else v.includes(t.key)||(clearInterval(this.randomInterval),this.randomInterval=void 0)}))}setConfig(){}registerStateEnterEvent(e,t,n,s=""){if(e=`${""!=s?`${s}:`:""}${e}`,Object.keys(this.stateEnterEvents).includes(t)||(this.stateEnterEvents[t]={}),null!=this.stateEnterEvents[t][e])return new Error(`There is already an SEE with name ${e} for the state ${t}`);u.log(`Registering SEE: ${e} in ${t}.`),this.stateEnterEvents[t][e]=n}registerBulkStateEnterEvent(e,t=""){for(const n in e)this.registerStateEnterEvent(n,e[n].state,e[n].function,t)}registerIngameRandomEvent(e,t,n=""){if(e=`${""!=n?`${n}:`:""}${e}`,null!=this.ingameRandomEvents[e])return new Error(`There is already an IRE with name ${e}`);u.log(`Registering IRE: ${e}.`),this.ingameRandomEvents[e]=t}registerBulkIngameRandomEvent(e,t=""){for(const n in e)this.registerIngameRandomEvent(n,e[n],t)}initStateEnterEvents(){u.log(`Initializing State Enter Events with chance ${this.stateEnterEventChance}`),this.signals.stateEntered.add((e=>{null!=this.stateEnterEvents[e.key]&&this.runStateEnterEvent(e.key)})),null!=this.stateEnterEvents.MainMenuState&&this.runStateEnterEvent("MainMenuState")}runStateEnterEvent(e){if(!this.RNG.chance(this.stateEnterEventChance))return;const t=this.RNG.choiceDict(this.stateEnterEvents[e]);if(this.settings.disabledEvents.includes(t))return u.log(`${t} disabled. Rerunning.`),void this.runStateEnterEvent(e);u.log(`Running SEE: ${t}. State: ${e}`),this.stateEnterEvents[e][t]()}initIngameRandomEvents(){u.log(`Initializing Ingame Random Events with timer ${this.randomEventInterval}`),this.signals.gameStarted.add((e=>{clearInterval(this.randomInterval),this.randomInterval=void 0,0!=Object.keys(this.ingameRandomEvents).length&&(this.randomInterval=setInterval((()=>{this.runIngameRandomEvent(e)}),this.randomEventInterval))}))}runIngameRandomEvent(e){const t=this.RNG.choiceDict(this.ingameRandomEvents);if(this.settings.disabledEvents.includes(t))return u.log(`${t} disabled. Rerunning.`),void this.runIngameRandomEvent(e);u.log(`Running IRE: ${t}.`),this.ingameRandomEvents[t](e)}}const b='#state_RELModExtrasSettingsState  .mainContent {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5em;\n  }\n  \n  #state_RELModExtrasSettingsState  label {\n    pointer-events: all;\n    display: grid;\n    grid-template-columns: 1fr auto;\n    align-items: center;\n    width: 10em;\n    height: 2em;\n  \n    border-radius: 0.3em;\n    padding: 0 0.4em;\n    transition: 0.15s background-color linear;\n  \n    &:hover {\n      background-color: #00000015;\n    }\n  }\n  \n  \n  #state_RELModExtrasSettingsState  input{\n    cursor: default;\n  \n    &:hover:not(::-webkit-color-swatch) {\n      filter: brightness(120%);\n    }\n  \n    &::-webkit-color-swatch-wrapper {\n      padding: 0;\n    }\n  \n    &::-webkit-color-swatch {\n      border: none;\n      border-radius: 0.2em;\n      width: 3em;\n      height: 1.5em;\n  \n      &:hover {\n        outline: 0.05em solid #ffffff40;\n      }\n    }\n  \n    background-color: #9b3333;\n    border-radius: 0.2em;\n    width: 1.5em;\n    height: 1.5em;\n  \n    &:checked {\n      content: "×" !important;\n      background-color: #398330;\n      position: relative;\n    }\n  \n    &:checked::after {\n      content: "×" !important;\n      text-align: center;\n      position: absolute;\n      font-size: 180%;\n      color: white;\n      top: 0;\n      left: 0;\n      bottom: 0;\n      right: 0;\n    }\n  }\n';return e.default=p,e.m=r,e}({},shapez,shapez,shapez,shapez,shapez,shapez,shapez);$shapez_registerMod(m.default,m.m);
