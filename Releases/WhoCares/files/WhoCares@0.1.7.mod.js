/**!
 * Name: WhoCares
 * Description: Bypasses most issues when loading a savegame.
 * Version: 0.1.7
 * Author(s): WaffleDevs
 */
var m=function(exports,game_state,logging,belt,mod$1,savegame_serializer,serializer_internal,ingame,main_menu,config,explained_result,global_registries,camera,game_time,mod_signals,vector,building_codes,belt_path,modloader,translations,utils,shape_definition,item_processor,loader,component,game_system_with_filter,map_chunk_view,logic_gate,base_hud_part,dynamic_dom_attach,notifications,wired_pins){"use strict";var img$1="data:image/webp;base64,UklGRnwAAABXRUJQVlA4IHAAAACwBgCdASpAAEAAPpE4mEeloyKhMB34ALASCUEOADIwaF+AfgBsWPAPwA/IDkAuwGZ+BNN/Dd+rRCSbDaA1AAD+w023w0Q7AxYRwKyXn/mSF12/HimRqnL2gsoGdeXasGNsWtg3etTVAjAPuGE2YAAA";const c={"0.1.6":["Error Viewer.","Error icons on entities."],"0.1.5":["Started Work on mod specific fixed. Added failsafe for CCT and possibly fixed Wrexcavator errors.","Added dialog disabling forceload when there are mod differences.","Added button to forceload without failing save first.","Set mod's warning buttons to timeout."],"0.1.0":["Combined Save My Save code into Who Cares","Added information dialog about Save My Save","Added missing and corrupt building removal","Added dialog for confirming forceloading","Fixed missing mod screen bug that errors on loading save"]},metadata={name:"WhoCares",description:"Bypasses most issues when loading a savegame.",version:"0.1.7",settings:{savedEntities:{},seenSmSNotice:!1,latestChangelogSeen:""},extra:{authors:[{name:"WaffleDevs",email:"",website:"https://skimnerphi.net/waffledevs",icon:"https://avatars.githubusercontent.com/u/77215539?s=64"}],updateURL:"https://skimnerphi.net/api/v1/latest/WhoCares"},id:"WhoCares",author:"WaffleDevs",doesNotAffectSavegame:!0,website:"https://skimnerphi.net/mods/WhoCares"};metadata.extra.changelog=c,metadata.extra.icon=img$1;const index="<h1>WhoCares</h1><h2>Latest: 0.1.6</h2><p>WaffleDevs</p><p>Does whatever it can to load your save. However, it has the chance to break it further, so always backup your save before force loading.\nIf a building throws an error, it will be visible in the error viewer.</p>";var img="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAABuwAAAbsBOuzj4gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAngSURBVHic5ZtrbFzFFcd/5969u16vHa/zsGPyxAmOSWyS4jyIHSd+RwSTp1kS28ReG0jDowEVISoEbSo1UhCopLQIoRZaqvZLpUpAhHiUODQ0rYQCVUrbKK36AQh5kJDYsePX7k4/rHd973oXr+27ToD/tzl758w5/3tm7sw5s6KU4tsM7WobcLXxrSfAMZmDiYg0NLXVhpRqAQoVauG506dCCvU/QTuhRP3m6KF33lGTOC9lssba2ti+RoRfgSowy8+e/iz20ZOiVPuRjnfenwy7JmUKNDS1PSCiDsU6nwAFSuTQmuraB1JuGJNAwNYm/3YFzwFG7G8uAzLdEq+bgZLnyirXb0+1fSmdAg2N/kIl8gGQEZG5DKhfJSzNFxbNFgRF15cD/PnDbp57o5u+QYuK7pCSFUc73jqRKhtTuggqkReIcf4H2zWK55vfupA9w8WmOheLr9PZ/ctOMwkZIuoFoCJVNqZsCmxrbmsA1kXaDj2e8yYI3LAki5/dlYmhW8TryirXN6TKzpQQ4Pf701A8bZbVr5LEzketERYvycS33GkRi6inKysr02w3lBQR0DUgjwDzIm1vBjSUJzmU28Bf6Waqx0LWvIDmfMRWI4dgOwG+lpZZwGNmWVOlhtuZoEMcpM3wsGuttYNS6rHS6upZdthohu0EBAPafsATaS/IEyqXjRL6sXAbbFjuZtFMi3keTWn7bTHSBFsJ2NrYvhqk0SxrWy+M0X0AxOvmoWpXrLSxrKZm9fgtHAnbCBAREVEHYNjfNUVC4ZzxuA+4nRTnu6i50fKlFglqB0RknEpHwjYCtjX5dwIrIm2XAXdVJ1bf0wcfnFQc/qiX7t5Q/Iey3NxX4SLNvIcUVpRV1O20yWx7doI+3/0ZQePKSZC8iOzOdRq+tfFf1IlPFU/9IURnD3R1XiRN72PfvTMoXhAb8sDnnbzUcYWX/jJglp421GBBR0dH90RttyUCAs4rj5udn54Fm0vjO68U/PSPYecBHA4HFy8H+eFL5wnFexdeN02rnOROsejLG8T5uB22T5iAhqb2fFHysFm2s1rDmWCTffpLON9lMkALb/vOXQzw2bnBkR3SnbjSHdxXERMdoh4ur63Nn5Dx2ECAgmeAqHU3zhHKliReo7r7Ek+5y1cSrAVeN9WFDm6arZulrlCIZ8Zo7ghMiIA7mlurQW2OtEXCnz3bke4Ep4OHql1oJvWiZPPaqrrqiageNwE+n08PhbRnzbKqZUJ+XgoIAPC6KcjV2FBsTSuE4Fmfz6cn6DUqxk1A0OHZhVAUabtd0FiZwvzKUBTcW+7E47SQXHT6fOeu8aodl8X1TU3ZiPzYLLujXMPrSdTDJnjDh6TW0phzAurH5eX12eNROS4CXJK2F5gWaedNhdtWpij0zUh3glOnocRgdrbF9GnKGNw7HpVjJsDX3LYYpXabZa21Go5xz8IxIisdQ4cHK2OPl2r32pqaxWNVN2YCgopnMaXSluYLywsm4e1H4AlHQdlCByvnW1h3hILWRTkZjImAbXe1bwRqI21dg7a6q1BcykoH4HvVLnTz8ELtmqq6jWNRlbT1Pp/PSUhZNh7rS4TZM8YynE3wOMHQmT9NY8uyEdn2Z4p8vqTTL0kTEHJk7gEWRtqZbriz4iqWFr3hKGhf4yTLWltY6D3fuSdZNUl5sKnxnlwl6gmzbHuFRkZK0pRJYigKMtOEu9fEvvDQE7fU1OQmoyYpAnSC+4DMSHtujlBXMokLXyJ43QBsWmaQP92yGGTqIdmXjIpRCdjS1FoiQqtZ1lYnlj35VYPHBYaOJrAnJn0mSGt51fqS0VSMSoCGfsD83MpFQvH114L3QxiKgpJ5OuU3WM7gmkIdGK37VxLQ0Ni2A1RZpG3o0FJ7jd2pGIoCgAcqnZaqElBWXl2346u6J/Rm465d6UqwpKHrVwkzx7XjTjGGomCWVxtRVVKK/cs3bkxP1DUhAUZ34FFgTnSMDNiWbHXnK5CRlnj6ZKaPU78pClpWG7FVpTnunv5HE3WNO6KvpWUuKEun5qqxVXcSIW8q5HiH26FQMCyf5mB2zohNTfLICkdBulP47roRVaVHy2tr58brFpeAYEB/CnBH2gvyhIql9ix8IrBns0bW0NE5EAiQnanzZOv0iX1ZMoaj4NYig0JrVcmtgjwV157YtHj4Lo86Ypbt82ssmm3vyt/TB//6RNHT08fyQhcZbhsW1+5+OB/OlP/jVJDdv+u1/CxKlcfePbKMunfvXm2ouhNFeZHY7jyAJw1WFAgV33Hb4zxYoqB4lk7tYmtqOiQckL17LYNZGsdPfuIHbo60R6vuXJPIis5cdq+zVpUEubns8FG/+fGod83NzVNAWbaPW0o1pk1JmampgcdFJDuTkyk0rYpZuUXtu2XDhqhXUQL6lPMJICfSnp4FmxJUd+zAh/9V/OL1ED96+SJ/+2fv6B2ShRDdFwA0rhxRVcpx9AajBztRStHQ5L9BIR8DUbq+v02jdHFqCHj1r4pX/hQugnRf7qKnu4v7t2azo8amcFPAqUsQCH9iD50I8ORrfeYnBvQgRe+99/Z/NAClZD8m52+cKylzfiAAv+8YrgBpWjgIX3ztEv2DNl3Zi4mCqkIHS61VJWdQC+9ytS07/PMRNkX7CrSnorozhLMXVeTFAMMEDAYUn58P2DeQxwWO4QV8T0xVCWHT6spb52uapt2DaS0oWyJcPzN1BORmC4bp6xQKhaPBaQjXTbfx2qIAU4ajoCBXo6rQelrUJXiPppQqNUtLFqb2qOt0WD+tka3w7s3ZuAybx3Zbt9alC0YQXOoQYYFZctMknPVvWynMzdF4/2PFFxeE227JpWRRCvJrhh5OXQfDUbZ83ojixQIHED2aZKSFT32TgeL5kYuTKT5fO4YJmOoRMtOEy9ESvfJqIMcjz3b3wcUJXzq5xjA4vOJe6FYm5wHkuCaoY+bn//3JN+hPVINBzPdujp8KWn4WOKaFEAsBv303RK/lPtLXGJeGd5hXBhTPH451TB3THINyEOFMRHTuEvz81W8ACT0D0NMPhJ3/yRv9nO40X8GRM0GnflCUUmxtbqsXxevm/jle2FmjsWSeMCVhRu0aRCAIl/uhs5dLVxQffRrk+cMDMc6DKLn9SMdbB6MJkW1N/pdBWuPpnDYF0mxIh8XDhS/O2qbLpSn6+8OO9g4ozl1OsJ4Jv37/3bf9YCpz64PpDwaNXg0YcQvzQlesxD6cPRPnalxKIa8YoYEHo63YlFhDo/92pcmLKGZOhjlx/jaXIsgZEe498u5blqke96qsz3f31ICh6jVUiUJKQC3DdAXeTqSQgB7g7wLHQB0LOvWDR99888vYhybtj5PXKr5mCT/78a0n4P/O5KQPc//WfQAAAABJRU5ErkJggg==";const SavegameSerializerExt=({$super:e,$old:t})=>({generateDumpFromGameRoot(e,t=!0){const o={camera:e.camera.serialize(),time:e.time.serialize(),map:e.map.serialize(),gameMode:e.gameMode.serialize(),entityMgr:e.entityMgr.serialize(),hubGoals:e.hubGoals.serialize(),entities:this.internal.serializeEntityArray(e.entityMgr.entities),beltPaths:e.systemMgr.systems.belt.serializePaths(),pinnedShapes:e.hud.parts.pinnedShapes?e.hud.parts.pinnedShapes.serialize():null,waypoints:e.hud.parts.waypoints?e.hud.parts.waypoints.serialize():null,modExtraData:{}};return mod_signals.MOD_SIGNALS.gameSerialized.dispatch(e,o),o},verifyLogicalErrors(e,t){if(!t.entities)return explained_result.ExplainedResult.bad("Savegame has no entities");const o=config.globalConfig.forceload,a=new Set;for(let i=0;i<t.entities.length;++i){const n=t.entities[i],s=n.uid;if(!Number.isInteger(s))return explained_result.ExplainedResult.bad("Entity has invalid uid: "+s);if(a.has(s)){if(!o)return explained_result.ExplainedResult.bad("Duplicate uid "+s);forceLoadBypassLogger.log(`Forceloading past "Duplicate uid ${s}"`),e.savegame.getCurrentDump().entities.splice(e.savegame.getCurrentDump().entities.indexOf(n))}if(a.add(s),!n.components)return explained_result.ExplainedResult.bad("Entity is missing key 'components': "+JSON.stringify(n));const r=n.components;for(const e in r){const t=global_registries.gComponentRegistry.findById(e);if(!t){if(o){forceLoadBypassLogger.log(`Forceloading past "Unknown component id: ${e}"`);continue}return explained_result.ExplainedResult.bad("Unknown component id: "+e)}const a=r[e],i=t.verify(a);if(i)return explained_result.ExplainedResult.bad("Component "+e+" has invalid data: "+i)}}return explained_result.ExplainedResult.good()},deserialize(e,t){config.globalConfig.removedEntityUids=[];const o=this.verifyLogicalErrors(t,e);if(!o.result)return explained_result.ExplainedResult.bad(o.reason);let a=null;a=a||t.entityMgr.deserialize(e.entityMgr);try{if("string"==typeof t.time.deserialize(e.time)&&config.globalConfig.forceload){const{timeSeconds:o,realtimeSeconds:a,speed:i}=new game_time.GameTime(t);e.time.timeSeconds=o,e.time.realtimeSeconds=a,e.time.speed={$:i.getId(),data:{}}}}catch(e){}a=a||t.time.deserialize(e.time);try{"string"==typeof t.camera.deserialize(e.camera)&&config.globalConfig.forceload&&(e.camera.prototype=new camera.Camera(t))}catch(e){}return a=a||t.camera.deserialize(e.camera),a=a||t.map.deserialize(e.map),a=a||t.gameMode.deserialize(e.gameMode),a=a||t.hubGoals.deserialize(e.hubGoals,t),a=a||this.internal.deserializeEntityArray(t,e.entities),a=a||t.systemMgr.systems.belt.deserializePaths(e.beltPaths),t.hud.parts.pinnedShapes&&(a=a||t.hud.parts.pinnedShapes.deserialize(e.pinnedShapes)),t.hud.parts.waypoints&&(a=a||t.hud.parts.waypoints.deserialize(e.waypoints)),a?explained_result.ExplainedResult.bad(a):(mod_signals.MOD_SIGNALS.gameDeserialized.dispatch(t,e),explained_result.ExplainedResult.good())}});function fixCCT(){entity.components.CommandController&&!entity.components.CommandController.command.startsWith("return;")&&(entity.components.CommandController.command=`return;\n${entity.components.CommandController.command}`)}const SerializerInternalExt=({$super:$super,$old:$old})=>({serializeEntityArray(e){const t=[];for(let o=0;o<e.length;++o){const a=e[o];a.queuedForDestroy||a.destroyed||t.push(a.serialize())}return t},deserializeEntityArray(e,t){for(let o=0;o<t.length;++o)this.deserializeEntity(e,t[o])},deserializeEntity(root,payload){const staticData=payload.components.StaticMapEntity;assert(staticData,"entity has no static data");let code=staticData.code,data=building_codes.getBuildingDataFromCode(code);if(null==data){if(config.globalConfig.forceload)return;throw new Error}const metaBuilding=data.metaInstance,entity=metaBuilding.createEntity({root:root,origin:vector.Vector.fromSerializedObject(staticData.origin),rotation:staticData.rotation,originalRotation:staticData.originalRotation,rotationVariant:data.rotationVariant,variant:data.variant});entity.uid=payload.uid,this.deserializeComponents(root,entity,payload.components),config.globalConfig.forceload&&eval(fixCCT+"fixCCT()"),root.entityMgr.registerEntity(entity,payload.uid),root.map.placeStaticEntity(entity)},deserializeComponents(e,t,o){for(const a in o){if(!t.components[a])continue;const i=t.components[a].deserialize(o[a],e);if(i)return i}}});function deserializePathsRep(e,[t]){if(console.log(config.globalConfig.forceload+" BELT DESER"),config.globalConfig.forceload){if(!Array.isArray(t))return"Belt paths are not an array: "+typeof t;for(let e=0;e<t.length;++e){for(let o=0;o<t[e].entityPath.length;o++)console.log(o,t[e].entityPath[o]),console.log(config.globalConfig.removedEntityUids.includes(t[e].entityPath[o]),!config.globalConfig.root.entityMgr.findByUid(t[e].entityPath[o],!1)),!config.globalConfig.removedEntityUids.includes(t[e].entityPath[o])&&config.globalConfig.root.entityMgr.findByUid(t[e].entityPath[o],!1)||(t[e].entityPath.splice(o,1),o--);if(0==t[e].entityPath.length)continue;console.log(t[e]);const o=belt_path.BeltPath.fromSerialized(this.root,t[e]);if(!(o instanceof belt_path.BeltPath))return"Failed to create path from belt data: "+o;this.beltPaths.push(o)}0===this.beltPaths.length?(forceLoadBypassLogger.warn("Recomputing belt paths (most likely the savegame is old or empty)"),this.recomputeAllBeltPaths()):forceLoadBypassLogger.warn("Restored",this.beltPaths.length,"belt paths")}else e(t)}function checkForModDifferencesRep(e,[t]){const o=modloader.MODS.computeModDifference(t.currentData.mods);if(0===o.missing.length&&0===o.extra.length)return config.globalConfig.hasAllMods=!0,Promise.resolve();config.globalConfig.hasAllMods=!1,console.log("Debug - file: MainMenuState.checkForModDifferences.ts:10 - checkForModDifferencesRep - hasAllMods:",config.globalConfig.hasAllMods);let a=translations.T.dialogs.modsDifference.desc;function i(e){return`\n                <div class="dialogModsMod">\n                    <div class="name">${e.name}</div>\n                    <div class="version">${translations.T.mods.version} ${e.version}</div>\n                    ${null!=e.website?`<button class="website styledButton" onclick="window.open('${e.website.replace(/"'/,"")}')">${translations.T.mods.modWebsite}</button>`:'<button class="website styledButton">No Website</button>'}\n\n                </div>\n            `}o.missing.length>0&&(a+="<h3>"+translations.T.dialogs.modsDifference.missingMods+"</h3>",a+=o.missing.map(i).join("<br>")),o.extra.length>0&&(a+="<h3>"+translations.T.dialogs.modsDifference.newMods+"</h3>",a+=o.extra.map(i).join("<br>"));const n=this.dialogs.showWarning(translations.T.dialogs.modsDifference.title,a,["cancel:good","continue:bad"]);return new Promise((e=>{n.continue.add(e)}))}function renderSavegamesRep(e,[]){const t=this.htmlElement.querySelector(".mainContainer .savegames");t&&t.remove();const o=this.savedGames;if(o.length>0){const e=utils.makeDiv(this.htmlElement.querySelector(".mainContainer .savegamesMount"),null,["savegames"]);for(let t=0;t<o.length;++t){const a=utils.makeDiv(e,null,["savegame"]);utils.makeDiv(a,null,["playtime"],utils.formatSecondsToTimeAgo(((new Date).getTime()-o[t].lastUpdate)/1e3)),utils.makeDiv(a,null,["level"],o[t].level?translations.T.mainMenu.savegameLevel.replace("<x>",""+o[t].level):translations.T.mainMenu.savegameLevelUnknown),utils.makeDiv(a,null,["name"],"<span>"+(o[t].name?o[t].name:translations.T.mainMenu.savegameUnnamed)+"</span>");const i=document.createElement("button");i.classList.add("styledButton","deleteGame"),i.setAttribute("aria-label","Delete"),a.appendChild(i);const n=document.createElement("button");n.classList.add("styledButton","downloadGame"),n.setAttribute("aria-label","Download"),a.appendChild(n);const s=document.createElement("button");s.classList.add("styledButton","resumeGame"),s.setAttribute("aria-label","Resumee"),a.appendChild(s);const r=document.createElement("button");r.classList.add("styledButton","forceLoad"),r.setAttribute("aria-label","ForceLoad"),r.textContent="F",a.appendChild(r),this.trackClicks(i,(()=>this.deleteGame(o[t]))),this.trackClicks(n,(()=>this.downloadGame(o[t]))),this.trackClicks(s,(()=>this.resumeGame(o[t]))),this.trackClicks(r,(()=>{config.globalConfig.WhoCaresDevMode&&(config.globalConfig.forceload=!0,this.resumeGame(o[t]));const{forceload:e}=this.dialogs.showWarning("Force Load?","Savegame failed to load. Forceloading may remove any errors and load anyway. This will destroy any data that is invalid. Create a backup before clicking continue.",["cancel:good","forceload:bad"+(config.globalConfig.WhoCaresDevMode?"":":timeout")]);e.add((()=>{config.globalConfig.forceload=!0,this.resumeGame(o[t])}))}))}}else utils.makeDiv(this.htmlElement.querySelector(".mainContainer .savegamesMount"),null,["savegamesNone"],translations.T.mainMenu.noActiveSavegames)}function onEnterPost(e){if(e.loadError)if(this.dialogs.close(),config.globalConfig.forceload){const{ok:e}=this.dialogs.showWarning("Failed","WhoCares was unable to forceload your savegame. Please DM 'WaffleDevs' on discord and send them the save game for additional help.",["ok:good"+(config.globalConfig.WhoCaresDevMode?"":":timeout")]);e.add((()=>{config.globalConfig.forceload=!1}))}else if(config.globalConfig.hasAllMods||config.globalConfig.WhoCaresDevMode){const{forceload:e}=this.dialogs.showWarning("Force Load?","Savegame failed to load. Forceloading may remove any errors and load anyway. This will destroy any data that is invalid. Create a backup before clicking continue.",["cancel:good","forceload:bad"+(config.globalConfig.WhoCaresDevMode?"":":timeout")]);e.add((()=>{const e=config.globalConfig.latestSavegame;if(null!=e.hubGoals)for(const t of Object.keys(e.hubGoals.storedShapes))try{shape_definition.ShapeDefinition.fromShortKey(t)}catch(o){forceLoadBypassLogger.log(`Forceloader removing errored shape ${t}.`),delete e.hubGoals.storedShapes[t]}config.globalConfig.forceload=!0,this.moveToState("InGameState",{savegame:e})}))}else{const{next:e}=this.dialogs.showWarning("Missing Mods","WhoCares refuses to attempt to fix any savegames that are missing mods. Please install the mods that show on the next menu before continuing.",["next:good"]);e.add((()=>{this.dialogs.close(),this.checkForModDifferences(config.globalConfig.latestSavegame)}))}}function moveToStatePre(e,t,o){try{console.log(t.savegame)}catch(e){}"InGameState"==e&&null!=t&&null!=t.savegame&&(config.globalConfig.latestSavegame=t.savegame)}class ErrorSymbolComponent extends component.Component{static getId(){return"ErrorSymbol"}static getSchema(){return{}}constructor(){super()}}class ErrorSymbolSystem extends game_system_with_filter.GameSystemWithFilter{constructor(e){super(e,[ErrorSymbolComponent]),this.errorSymbol=loader.Loader.getSprite("sprites/whocares/warning.png")}update(){for(let e=0;e<this.allEntities.length;++e){const t=this.allEntities[e];config.globalConfig.foundErrors[t.uid]||t.removeComponent(ErrorSymbolComponent,!0)}}drawChunk(e,t){const o=t.containedEntitiesByLayer.regular.concat(t.containedEntitiesByLayer.wires);for(let t=0;t<o.length;++t){const a=o[t];if("regular"==a.layer&&e.runningAfterWires)continue;if("wires"==a.layer&&!e.runningAfterWires)continue;if(!a.components.ErrorSymbol)continue;const i=a.components.StaticMapEntity;e.context;const n=i.getTileSpaceBounds().getCenter().toWorldSpace();e.visibleRect.containsCircle(n.x,n.y,40)&&this.errorSymbol.drawCached(e,n.x-5,n.y-5,10,10)}}}let mod;function initializeErrorViewer(e){mod=e,mod.signals.stateEntered.add((e=>{config.globalConfig.foundErrors={}}))}function registerError(e,t){config.globalConfig.foundErrors[t.uid]||(config.globalConfig.foundErrors[t.uid]={error:e,entity:t},t.addComponent(new ErrorSymbolComponent),forceLoadBypassLogger.log(`Bypassing ${e.message}`),setTimeout((()=>{delete config.globalConfig.foundErrors[t.uid]}),500))}function startNewChargeRep(e,[t]){try{const e=t.components.ItemProcessor,o=e.inputSlots,a=[],i=this.handlers[e.type];assert(i,"No handler for processor type defined: "+e.type),i({entity:t,items:o,outItems:a,inputCount:e.inputCount});for(let e=0;e<a.length;++e)a[e].doNotTrack||this.root.signals.itemProduced.dispatch(a[e].item);const n=1/this.root.hubGoals.getProcessorBaseSpeed(e.type),s=Math.min(n,e.bonusTime),r=n-s;e.bonusTime-=s,e.ongoingCharges.push({items:a,remainingTime:r}),e.inputSlots.clear(),e.inputCount=0}catch(e){registerError(e,t)}}config.globalConfig.foundErrors={};const style=".forceLoad {\n  grid-column: 3/4;\n  grid-row: 1/2;\n  background-color: transparent;\n  background-size: 80%;\n  align-self: start;\n  border-radius: 0;\n  opacity: 0.4;\n  top: -5px;\n  right: 25px;\n}\n.forceLoad:hover {\n  opacity: 0.5;\n}\n\n#ingame_HUD_ErrorViewer {\n  position: absolute;\n  right: 10px;\n  margin: auto;\n  width: max-content;\n  height: 60%;\n  padding: 10px;\n  top: 50%;\n  bottom: 50%;\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  z-index: 200;\n  background-color: rgba(76, 80, 92, 0.9490196078);\n  color: rgba(255, 255, 255, 0.8784313725);\n  font-size: 75%;\n  border-radius: 0.5em;\n  overflow-y: scroll;\n}\n\n.WhoCaresError {\n  background-color: rgba(59, 62, 70, 0.9490196078);\n  border-radius: 0.25em;\n  padding: 3px;\n}\n\n.WhoCaresError > button > div {\n  font-size: 150% !important;\n  width: max-content;\n}\n\n#errorViewerToggle {\n  filter: grayscale(1) !important;\n  padding: 0;\n}";class HUDErrorViewer extends base_hud_part.BaseHUDPart{constructor(e){super(e),this.errorDivs=[]}createElements(e){this.element=utils.makeDiv(e,"ingame_HUD_ErrorViewer"),this.button=utils.makeButton(document.getElementById("ingame_HUD_GameMenu"),["styledButton"],""),this.button.id="errorViewerToggle",this.button.style.backgroundImage=`url(${img})`,this.button.addEventListener("click",(()=>{this.toggle()}))}initialize(){this.visible=!0,document.getElementById("ingame_HUD_ErrorViewer").addEventListener("click",(function(e){console.log("aa");let t=e.target.closest(".WhoCaresError");if(t&&this.contains(t)){const e=config.globalConfig.root,o=e.entityMgr.findByUid(Number.parseInt(t.id),!1);if(!o)return;e.camera.center=o.components.StaticMapEntity.origin.multiplyScalar(config.globalConfig.tileSize),e.hud.signals.notification.dispatch("Moved to erroring building.",notifications.enumNotificationType.info),e.currentLayer=o.layer}})),this.visible=!1,this.edomAttach=new dynamic_dom_attach.DynamicDomAttach(this.root,this.element),this.bdomAttach=new dynamic_dom_attach.DynamicDomAttach(this.root,this.button)}update(){this.edomAttach.update(this.visible),this.bdomAttach.update(!0),this.updateErrors()}toggle(){this.visible=!this.visible}createErrorDiv(e,t){this.visible&&(document.getElementById(t.uid.toString())||(this.errorDivs.push(t.uid.toString()),utils.makeDiv(this.element,t.uid.toString(),["WhoCaresError"],`\n       <button> <div class="name">${e.name}</div>\n       <div class="message">${e.message}</div></button>\n            `)))}removeErrorDiv(e){this.visible&&document.getElementById(e).remove()}updateErrors(){for(const[e,t]of Object.entries(config.globalConfig.foundErrors))this.createErrorDiv(t.error,t.entity);const e=this.element.children;for(var t=0;t<e.length;t++)config.globalConfig.foundErrors[e[t].id]||this.removeErrorDiv(e[t].id)}}function updateRep(e){for(let e=0;e<this.allEntities.length;++e){const t=this.allEntities[e];try{const e=t.components.LogicGate,o=t.components.WiredPins,a=[];let i=!1;for(let e=0;e<o.slots.length;++e){const t=o.slots[e];if(t.type!==wired_pins.enumPinSlotType.logicalAcceptor)continue;const n=t.linkedNetwork;if(n){if(n.valueConflict){i=!0;break}a.push(n.currentValue)}else a.push(null)}if(i){for(let e=0;e<o.slots.length;++e){const t=o.slots[e];t.type===wired_pins.enumPinSlotType.logicalEjector&&(t.value=null)}continue}const n=this.boundOperations[e.type](a);if(Array.isArray(n)){let e=0;for(let t=0;t<o.slots.length;++t){const a=o.slots[t];a.type===wired_pins.enumPinSlotType.logicalEjector&&(a.value=n[e++])}}else assert(a.length===o.slots.length-1,"Bad slot config, should have N acceptor slots and 1 ejector"),assert(o.slots[0].type===wired_pins.enumPinSlotType.logicalEjector,"Slot 0 should be ejector"),o.slots[0].value=n}catch(e){if(!config.globalConfig.forceload)throw this.root.gameState.saveThenGoToState("MainMenuState",{loadError:e}),e;registerError(e,t)}}}const getMod=e=>(e||(e="WhoCares"),modloader.MODS.mods.find((t=>t.metadata.id===e)));function fixWrexcavator(){if(!getMod("Wrexcavator"))return;const e=global_registries.gItemRegistry.getById("wreck"),t=global_registries.gItemRegistry.entries.indexOf(e);e.drawItemCenteredClipped=(e,t,o,a=config.globalConfig.defaultItemDiameter)=>{const i=.6*a;this.cachedSprite||(this.cachedSprite=loader.Loader.getSprite("sprites/wreck/shovel.png")),this.cachedSprite.drawCachedCentered(o,e,t,i)},global_registries.gItemRegistry.entries[t]=e}logging.createLogger("forceload/core");const forceLoadExeptionLogger=logging.createLogger("forceload/error"),forceLoadBypassLogger=logging.createLogger("forceload/bypass");class WhoCares extends mod$1.Mod{init(){config.globalConfig.WhoCaresDevMode=!0,config.globalConfig.forceload=!1,config.globalConfig.latestSavegame=void 0,config.globalConfig.hasAllMods=!1,config.globalConfig.removedEntityUids=[],this.metadata.extra.readme=index,this.modInterface.registerTranslations("en",{dialogs:{buttons:{forceload:"ForceLoad",next:"Next"}}}),this.modInterface.runBeforeMethod(game_state.GameState,"moveToState",moveToStatePre),this.modInterface.runAfterMethod(main_menu.MainMenuState,"onEnter",onEnterPost),this.modInterface.replaceMethod(belt.BeltSystem,"deserializePaths",deserializePathsRep),this.modInterface.replaceMethod(item_processor.ItemProcessorSystem,"startNewCharge",startNewChargeRep),this.modInterface.replaceMethod(main_menu.MainMenuState,"checkForModDifferences",checkForModDifferencesRep),this.modInterface.replaceMethod(main_menu.MainMenuState,"renderSavegames",renderSavegamesRep),this.modInterface.replaceMethod(logic_gate.LogicGateSystem,"update",updateRep),this.modInterface.extendClass(savegame_serializer.SavegameSerializer,SavegameSerializerExt),this.modInterface.extendClass(serializer_internal.SerializerInternal,SerializerInternalExt),this.signals.stateEntered.add((state=>{state instanceof main_menu.MainMenuState&&(this.settings.seenSmSNotice||(this.dialogs.showInfo("Notice:",'With the Authors permission, Who Cares now bundles a mod called "Save my Save" by StealthC within. If you would like to visit the webpage for Save my Save, click <a onclick="window.open(\'https://mod.io/g/shapez/m/save-my-save\')">here</a>.',["ok:good"]),this.settings.seenSmSNotice=!0,this.saveSettings()),config.globalConfig.forceload&&eval(fixWrexcavator+"fixWrexcavator()"))})),this.modInterface.replaceMethod(ingame.InGameState,"saveThenGoToState",((e,[t,o])=>{if(!t)return new SyntaxError;e(t,o)})),this.modInterface.registerComponent(ErrorSymbolComponent),this.modInterface.runAfterMethod(map_chunk_view.MapChunkView,"drawWiresForegroundLayer",(function(e){const t=this.root.systemMgr.systems;e.runningAfterWires=!0,t.whocares_error_symbol.drawChunk(e,this)})),this.modInterface.registerGameSystem({id:"whocares_error_symbol",systemClass:ErrorSymbolSystem,before:"end",drawHooks:["staticAfter"]}),this.modInterface.registerSprite("sprites/whocares/warning.png",img),this.modInterface.registerCss(style),this.signals.gameInitialized.add(this.registerHud,this),initializeErrorViewer(this)}registerHud(e){config.globalConfig.root=e;const t=new HUDErrorViewer(e,this);e.hud.parts.errorViewer=t,t.createElements(document.body),this.signals.hudElementInitialized.dispatch(t),t.initialize(),this.signals.hudElementFinalized.dispatch(t)}}return exports.default=WhoCares,exports.forceLoadBypassLogger=forceLoadBypassLogger,exports.forceLoadExeptionLogger=forceLoadExeptionLogger,exports.m=metadata,exports}({},shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez,shapez);$shapez_registerMod(m.default,m.m);
